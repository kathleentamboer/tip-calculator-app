<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Nice Numbers</title>
  <script src="//use.typekit.net/zap1aww.js"></script>
  <script>try{Typekit.load();}catch(e){}</script>
  <link rel="stylesheet" href="style.css" type="text/css">
</head>
<body>
  <main class="container">
    <section class="bill">
      <header class="group">
        <h1>Bill</h1>
        <button id="reset">Reset</button>
      </header>
      <label>
        <input id="input-bill" type="number" value="0.00">
      </label>
    </section>

    <section class="percent">
      <div class="percent-number group">
        <output class="percent-number-output" for="percent-range" id="output-percent">15</output>
        <input class="percent-slider" type="range" min="0" max="50" value="15" id="input-percent" step="1">
      </div>
      <ul class="percent-numbers group">
        <li><button data-percent="15">15%</button></li>
        <li><button data-percent="25">25%</button></li>
        <li><button data-percent="20">20%</button></li>
      </ul>
    </section>

    <section class="tip">
      <h1>Tip</h1>
      <label>
        <input id="input-tip" type="number" value="0.00">
      </label>
    </section>

    <section class="total">
      <h1>Total</h1>
      <label>
        <input id="input-total" type="number" value="0.00">
      </label>
    </section>

    <section class="round group">
      <button data-round="down">Round</button>
      <button data-round="up">Round</button>
    </section>

    </main>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script>

  var twoDigits = function(number){
    if(number == 0){
      return "0.00";
    }
    number = Math.round(number * 100);
    console.log(number);
    var string = "" + number;
    var dollars = string.slice(0, -2);
    var cents = string.slice(-2);
    return dollars + "." + cents;
  }


  $(document).on("ready", function(){

    var $inputBill = $("#input-bill");
    var $inputTip = $("#input-tip");
    var $inputPercent = $("#input-percent");
    var $inputTotal = $("#input-total");
    var $outputPercent = $("#output-percent");

    var $percentButtons = $(".percent-numbers button");

    var $roundButtons = $(".round button");

    var $reset = $("#reset")

    var bill = 0;
    var percent = 0.15;
    var tip = 0;
    var total = 0;

    var updateTip = function(){
      total = tip + bill;
      $inputTip.val(twoDigits(tip));
      $inputTotal.val(twoDigits(total));
    };

    var updateSlider = function(percent){
      $inputPercent.val(Math.round(percent * 100));
      $outputPercent.html(Math.round(percent  * 100));

      $percentButtons.each(function(){
        var $button = $(this);
        console.log($button);
        if ($button.attr("data-percent") == percent * 100){
          $button.addClass("active");
        } else {
          $button.removeClass("active");
        }
      });
    };


    $reset.on("click" , function(event){
      bill = 0;
      percent = 0.15;
      tip = 0;
      total = 0;
      $inputBill.val(twoDigits(bill));
      updateTip();
      updateSlider(percent);
    });

    $inputBill.on("change", function(event){
      bill = parseFloat($(this).val());
      console.log(bill);
      updateTip();
    });

    $inputPercent.on("change", function(event){
      percent = parseFloat($(this).val()) / 100;
      console.log(percent);
      tip = bill * percent;
      console.log(tip);
      $outputPercent.html(Math.round(percent  * 100));
      updateTip();
    });

    $percentButtons.on("click", function(event){
      var $button = $(this);
      console.log($button);
      percent = parseFloat( $button.attr("data-percent")) / 100;
      tip = bill * percent;
      updateSlider(percent);
      updateTip();
    });

    $roundButtons.on("click", function(event){
      var $button = $(this);
      var round = $button.attr("data-round");
      if (round == "up"){
        total = Math.ceil(total);
      } else {
        total = Math.floor(total);
      }
      tip = total - bill;
      updateTip();
      percent = (tip / bill);
      updateSlider(percent);
    });

    $inputTotal.on("change" , function(event){
      total = parseFloat($(this).val());
      tip = total - bill;
      percent = (tip / bill);
      updateTip();
      updateSlider(percent);
    });

    $inputTip.on("change" , function(event){
      tip = parseFloat($(this).val());
      total = bill + tip;
      percent = (tip / bill);
      updateTip();
      updateSlider(percent);
    })

  });

</script>

</body>
</html>
